<!DOCTYPE html>
<html lang="fr" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TutoAfrica - Espace Ã‰tudiant</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --vert-tuto: #2D7D62;
            --largeur-sidebar: 280px;
            --vitesse: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-bs-theme="light"] {
            --fond-page: #f1f5f9;
            --fond-carte: #ffffff;
            --fond-menu: #ffffff;
            --couleur-texte: #1e293b;
            --bordure: rgba(0,0,0,0.05);
        }

        [data-bs-theme="dark"] {
            --fond-page: #0f172a;
            --fond-carte: #1e293b;
            --fond-menu: #111827;
            --couleur-texte: #f8fafc;
            --bordure: rgba(255,255,255,0.1);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--fond-page); 
            color: var(--couleur-texte);
            transition: var(--vitesse);
        }

        /* Menu LatÃ©ral */
        .wrapper-menu { padding: 20px; height: 100vh; position: fixed; width: var(--largeur-sidebar); z-index: 1000; }
        .menu-lateral { 
            background: var(--fond-menu); 
            border: 1px solid var(--bordure); 
            border-radius: 24px; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .logo-tuto { padding: 30px 20px; text-align: center; }
        .logo-tuto a { text-decoration: none; color: var(--vert-tuto); font-weight: 800; font-size: 1.4rem; }

        .carte-profil-menu {
            margin: 0 15px 25px;
            padding: 15px;
            background: var(--fond-page);
            border-radius: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: inherit;
            transition: var(--vitesse);
            border: 1px solid var(--bordure);
        }
        .carte-profil-menu:hover { transform: translateY(-2px); border-color: var(--vert-tuto); }
        .img-avatar { width: 45px; height: 45px; border-radius: 12px; object-fit: cover; }

        .nav-link {
            margin: 4px 15px; padding: 12px 18px; border-radius: 14px;
            color: #94a3b8; font-weight: 600; transition: 0.3s;
        }
        .nav-link:hover { background: rgba(45, 125, 98, 0.1); color: var(--vert-tuto); }
        .nav-link.active { background: var(--vert-tuto) !important; color: white !important; }

        /* Zone Principale */
        .contenu-principal { margin-left: var(--largeur-sidebar); padding: 40px; }

        .carte-action {
            background: var(--fond-carte);
            border: 1px solid var(--bordure);
            border-radius: 28px;
            padding: 30px;
            height: 100%;
            transition: var(--vitesse);
        }
        .carte-action:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }

        .cercle-icone {
            width: 50px; height: 50px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; margin-bottom: 20px;
        }

        .btn-tuto {
            border-radius: 12px; padding: 10px; font-weight: 700; width: 100%; border: none; transition: 0.3s;
        }

        @media (max-width: 991px) {
            .wrapper-menu { display: none; }
            .contenu-principal { margin-left: 0; padding: 20px; }
        }
    </style>
</head>
<body>

<div class="modal fade" id="modalProfil" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow" style="border-radius: 24px;">
            <div class="modal-body p-4 text-center">
                <i class="bi bi-person-check fs-1 text-success mb-3"></i>
                <h4 class="fw-bold" data-fr="Presque fini !" data-en="Almost there!">Presque fini !</h4>
                <p class="text-muted" data-fr="Pour personnaliser tes cours, dis-nous ton niveau." data-en="To personalize your courses, tell us your level.">Pour personnaliser tes cours, dis-nous ton niveau.</p>
                
                <select class="form-select mb-4 py-3" id="nouveau-niveau" style="border-radius: 12px;">
                    <option value="" disabled selected data-fr="Ton niveau d'Ã©tudes..." data-en="Your education level...">Ton niveau d'Ã©tudes...</option>
                    <option value="Primaire">Primaire</option>
                    <option value="Secondaire">Secondaire</option>
                    <option value="Universitaire">Universitaire</option>
                </select>

                <button id="btn-sauver-profil" class="btn btn-success w-100 py-3 fw-bold" style="background: var(--vert-tuto); border-radius: 12px;">
                    C'est parti !
                </button>
            </div>
        </div>
    </div>
</div>

<div class="wrapper-menu">
    <aside class="menu-lateral">
        <div class="logo-tuto">
            <a href="index.html">TutoAfrica</a>
        </div>

        <a href="profil.html" class="carte-profil-menu">
            <img src="https://ui-avatars.com/api/?name=User&background=2D7D62&color=fff" class="img-avatar" id="user-photo">
            <div class="overflow-hidden">
                <div class="fw-bold text-truncate small" id="user-nom">Chargement...</div>
                <div class="text-muted" style="font-size: 0.7rem;" data-fr="Voir profil" data-en="View profile">Voir profil</div>
            </div>
        </a>
        
        <nav class="nav nav-pills flex-column">
            <a href="Ressources/epreuve.html" class="nav-link"><i class="bi bi-file-earmark-text me-3"></i> <span data-fr="Ã‰preuves" data-en="Exams">Ã‰preuves</span></a>
            <a href="tuteuriA.html" class="nav-link"><i class="bi bi-robot me-3"></i> <span data-fr="Tuteur IA" data-en="AI Tutor">Tuteur IA</span></a>
            <a href="tuteurD.html" class="nav-link"><i class="bi bi-people me-3"></i> <span data-fr="Experts Tuteurs" data-en="Experts Tutors">Experts Tuteurs</span></a>
        </nav>

        <div class="mt-auto p-3">
            <button onclick="deconnexion()" class="btn btn-link text-danger text-decoration-none fw-bold small p-2">
                <i class="bi bi-power me-2"></i> <span data-fr="DÃ©connexion" data-en="Logout">DÃ©connexion</span>
            </button>
        </div>
    </aside>
</div>

<main class="contenu-principal">
    <header class="mb-5">
        <h1 class="fw-800"><span data-fr="Bonjour" data-en="Hello">Bonjour</span> <span id="salut-nom">...</span> ! ðŸ‘‹</h1>
        <p class="text-muted" data-fr="PrÃªt pour tes rÃ©visions du jour ?" data-en="Ready for today's review?">PrÃªt pour tes rÃ©visions du jour ?</p>
    </header>

    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <div class="carte-action">
                <div class="cercle-icone bg-success-subtle text-success">
                    <i class="bi bi-robot"></i>
                </div>
                <h4 class="fw-bold" data-fr="Assistant IA" data-en="AI Assistant">Assistant IA</h4>
                <p class="text-muted small mb-4" data-fr="Pose tes questions et obtiens des explications instantanÃ©es." data-en="Ask questions and get instant explanations.">Pose tes questions et obtiens des explications instantanÃ©es.</p>
                <button onclick="window.location.href='tuteuriA.html'" class="btn-tuto btn-success text-white" style="background: var(--vert-tuto);">
                    <span data-fr="Lancer le chat" data-en="Start Chat">Lancer le chat</span>
                </button>
            </div>
        </div>

        <div class="col-md-6">
            <div class="carte-action">
                <div class="cercle-icone bg-primary-subtle text-primary">
                    <i class="bi bi-people"></i>
                </div>
                <h4 class="fw-bold" data-fr="Session avec Expert" data-en="Expert Session">Session avec Expert</h4>
                <p class="text-muted small mb-4" data-fr="Besoin d'un tuteur humain pour t'aider ?" data-en="Need a human tutor to help you?">Besoin d'un tuteur humain pour t'aider ?</p>
                <button onclick="window.location.href='tuteurD.html'" class="btn-tuto btn-primary text-white">
                    <span data-fr="Trouver un tuteur" data-en="Find a tutor">Trouver un tuteur</span>
                </button>
            </div>
        </div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAvjQaWPrA7M5b0XmDrrBwTKDlv5q-nXDM",
        authDomain: "isi3projetwebgroupe6fr.firebaseapp.com",
        projectId: "isi3projetwebgroupe6fr",
        storageBucket: "isi3projetwebgroupe6fr.firebasestorage.app",
        messagingSenderId: "1024122923638",
        appId: "1:1024122923638:web:f1a367d84a567449494d57"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // 1. VÃ©rification de l'utilisateur
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const docRef = doc(db, "utilisateurs", user.uid);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const userData = docSnap.data();
                
                // Affichage du nom
                document.getElementById('user-nom').textContent = userData.nom;
                document.getElementById('salut-nom').textContent = userData.nom;
                if(user.photoURL) document.getElementById('user-photo').src = user.photoURL;

                
                if (!userData.niveau || userData.niveau === "Non spÃ©cifiÃ©") {
                    const maModal = new bootstrap.Modal(document.getElementById('modalProfil'));
                    maModal.show();
                }
            }
        } else {
            window.location.href = "connexion.html";
        }
    });

    // 3. Sauvegarder le niveau manquant
    document.getElementById('btn-sauver-profil').addEventListener('click', async () => {
        const niveauChoisi = document.getElementById('nouveau-niveau').value;
        if (!niveauChoisi) return alert("Choisis ton niveau !");

        const user = auth.currentUser;
        await updateDoc(doc(db, "utilisateurs", user.uid), {
            niveau: niveauChoisi
        });
        
        location.reload(); // On rafraÃ®chit pour enlever la modal
    });

    // DÃ©connexion
    window.deconnexion = () => {
        signOut(auth).then(() => window.location.href = "index.html");
    };

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>